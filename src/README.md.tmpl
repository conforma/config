# Enterprise Contract Configuration Files

This repo contains a set of `policy.yaml` files which can be used by the [Enterprise Contract
Command Line Interface](https://github.com/enterprise-contract/ec-cli) with a variety of
environments.

## Konflux CI

When using Red Hat's [Konflux CI](https://github.com/konflux-ci/), (formerly
[Red Hat App Studio](https://github.com/redhat-appstudio/)),
environment, there is a predefined Integration Test pipeline definition for each of the configs in
this section. They can be used when creating an Integration Test in Konflux as per the [documentation
here](https://redhat-appstudio.github.io/docs.appstudio.io/Documentation/main/how-to-guides/proc_managing-compliance-with-the-enterprise-contract/).

The policy configuration files are:
{{ range $k, $v := ds "data" }}
  {{- with coll.Dict "directory" $k "data" $v }}
    {{- if not (index .data "deprecated") }}
      {{- if eq .data.environment "konflux" }}
        {{- template "konflux" . }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}

## Red Hat Trusted Application Pipeline (RHTAP)

This configuration is designed to be used with RHTAP. The sample RHTAP
pipelines include [a GitOps PR pipeline with an EC
check](https://github.com/redhat-appstudio/tssc-sample-pipelines/blob/main/pac/pipelines/gitops-pull-request-rhtap.yaml).
The pipeline uses the [`verify-enterprise-contract` task](https://github.com/redhat-appstudio/tssc-sample-pipelines/blob/main/pac/tasks/verify-enterprise-contract.yaml),
with this EC configuration.

It's similar to the Konflux CI default configuration but for compatibility and
stability reasons it doesn't use policies directly from `main` branch.

The policy configuration files are:
{{ range $k, $v := ds "data" }}
  {{- with coll.Dict "directory" $k "data" $v }}
    {{- if not (index .data "deprecated") }}
      {{- if eq .data.environment "rhtap" }}
        {{- template "rhtap" . }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}

## Konflux CI & Red Hat Trusted Application Pipeline (RHTAP) - Tasks

These are policy rules used to verify Tekton Task definitions meet the Red Hat guidelines for being
considered trusted.

The policy configuration files are:
{{ range $k, $v := ds "data" }}
  {{- with coll.Dict "directory" $k "data" $v }}
    {{- if not (index .data "deprecated") }}
      {{- if eq .data.environment "konflux-tasks" }}
        {{- template "konflux-tasks" . }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}

## GitHub

Container images built via [GitHub Actions](https://docs.github.com/actions) can be verified with
the following policy configurations.
{{ range $k, $v := ds "data" }}
  {{- with coll.Dict "directory" $k "data" $v }}
    {{- if not (index .data "deprecated") }}
      {{- if eq .data.environment "github" }}
        {{- template "github" . }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}
## See also

* [Policy Rule Documentation](https://enterprisecontract.dev/docs/ec-policies/release_policy.html)
* [Getting Started with Enterprise Contract &amp; Konflux CI](https://enterprisecontract.dev/docs/user-guide/main/getting-started.html)
